<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solución IoT de dispensadores</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Estilos propios -->
  <link rel="stylesheet" href="css/styles.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>

  <!-- Adaptador de fechas para Chart.js (date-fns adapter) -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

</head>

<body class="bg-light">

<div class="container py-4">
  <header class="mb-4 text-center">
    <h1>Sistema IoT de Dispensadores</h1>
    <p class="text-muted">
      Control y monitoreo de zacate, alfalfa y grano
    </p>
  </header>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="tabs">
    <li class="nav-item">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#controlTab">
        Control
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#monitorTab">
        Monitoreo
      </button>
    </li>
  </ul>

  <div class="tab-content mt-3">

    <!-- ================= CONTROL ================= -->
    <div class="tab-pane fade show active" id="controlTab">
      <div class="row" id="controlDevices">
        <!-- tarjetas generadas por control.js -->
      </div>
    </div>

    <!-- ================= MONITOREO ================= -->
    <div class="tab-pane fade" id="monitorTab">

      <!-- Selector -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label">Selecciona un dispensador</label>
          <select id="monitorDeviceSelect" class="form-select"></select>
        </div>
        <div class="col-md-6 d-flex align-items-end justify-content-end">
          <small class="text-muted">
            Última actualización: <span id="monitorLastUpdate">-</span>
          </small>
        </div>
      </div>

      <!-- Gráficas -->
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card">
            <div class="card-body">
              <h6 class="card-title">Peso vs Tiempo</h6>
              <canvas id="weightChart"></canvas>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card">
            <div class="card-body">
              <h6 class="card-title">Estatus vs Tiempo</h6>
              <canvas id="statusChart"></canvas>
              <small class="text-muted">
                1 = Apagado | 2 = Dispensando | 3 = Error
              </small>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabla -->
      <div class="card mt-3">
        <div class="card-body">
          <h6 class="card-title">Últimos 10 registros</h6>
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Descripción</th>
                  <th>Estatus</th>
                  <th>Peso (gr)</th>
                  <th>Peso dispensado (gr)</th>
                  <th>Fecha / Hora</th>
                </tr>
              </thead>
              <tbody id="monitorTableBody">
                <!-- filas generadas por monitor.js -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- API -->
<script src="js/api.js"></script>

<!-- Control -->
<script src="js/control.js"></script>

<!-- Monitoreo -->
<script src="js/monitor.js"></script>

<!-- Inicialización -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    renderControl();   // pestaña Control
    // monitor.js se auto-inicia solo
  });
</script>

</body>
</html>
